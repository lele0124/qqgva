
# 基础组件

<cite>
**本文档中引用的文件**
- [svgIcon.vue](file://web/src/components/svgIcon/svgIcon.vue)
- [common.vue](file://web/src/components/upload/common.vue)
- [image.vue](file://web/src/components/upload/image.vue)
- [cropper.vue](file://web/src/components/upload/cropper.vue)
- [QR-code.vue](file://web/src/components/upload/QR-code.vue)
- [selectImage.vue](file://web/src/components/selectImage/selectImage.vue)
- [selectComponent.vue](file://web/src/components/selectImage/selectComponent.vue)
- [selectFile.vue](file://web/src/components/selectFile/selectFile.vue)
- [arrayCtrl.vue](file://web/src/components/arrayCtrl/arrayCtrl.vue)
- [fileUploadAndDownload.js](file://web/src/api/fileUploadAndDownload.js)
- [attachmentCategory.js](file://web/src/api/attachmentCategory.js)
- [image.js](file://web/src/utils/image.js)
</cite>

## 目录
1. [图标组件（svgIcon）](#图标组件svgicon)
2. [文件上传组件系列](#文件上传组件系列)
   - [普通上传（common）](#普通上传common)
   - [压缩上传（image）](#压缩上传image)
   - [裁剪上传（cropper）](#裁剪上传cropper)
   - [二维码上传（QR-code）](#二维码上传qr-code)
3. [图片选择器（selectImage）](#图片选择器selectimage)
4. [文件选择器（selectFile）](#文件选择器selectfile)
5. [数组控制器（arrayCtrl）](#数组控制器arrayctrl)
6. [OSS支持与断点续传机制](#oss支持与断点续传机制)
7. [实际调用示例与表单集成](#实际调用示例与表单集成)
8. [样式覆盖与响应式行为](#样式覆盖与响应式行为)

## 图标组件（svgIcon）

`svgIcon` 组件用于统一管理项目中的 SVG 图标资源，通过动态 `use` 标签引用预注册的 SVG 符号。该组件支持颜色自定义和类名扩展，适用于各种需要轻量级图标的场景。

### Props 定义
- **name**: 字符串类型，必填项，指定要使用的 SVG 图标名称，对应于全局注册的图标 ID。
- **color**: 字符串类型，可选，默认值为 `'currentColor'`，控制图标的填充颜色。

### 事件与插槽
该组件不触发任何自定义事件，也不提供插槽内容。

### 内部实现逻辑
组件使用 Vue 的 `computed` 属性动态生成类名 `svg-icon ${name}`，确保每个图标具有独立的样式作用域。SVG 元素通过 `xlink:href` 指向以 `#` 开头的图标符号，依赖前端构建工具将 SVG 雪碧图注入 DOM。

**Section sources**
- [svgIcon.vue](file://web/src/components/svgIcon/svgIcon.vue#L1-L32)

## 文件上传组件系列

本节介绍 `upload` 目录下的四个核心上传组件：普通上传、压缩上传、裁剪上传和二维码上传。这些组件均基于 Element Plus 的 `el-upload` 封装，适配不同业务需求。

### 普通上传（common）

提供基础的多文件上传功能，支持图像和视频格式校验，并限制大小（图片 ≤ 500KB，视频 ≤ 5MB）。上传前进行 MIME 类型检查，防止非法文件提交。

#### Props 定义
- **classId**: 数字类型，可选，默认值为 `0`，用于标记文件所属分类。

#### 事件机制
- **on-success**: 上传成功后触发，携带返回的文件 URL 数据。
- **on-error**: 上传失败时触发，显示错误提示。

#### 实现逻辑
通过 `before-upload` 钩子执行前置校验，利用 `isImageMime` 和 `isVideoMime` 工具函数判断文件类型。上传地址由 `getBaseUrl()` 动态拼接，请求头携带用户 Token 认证信息。

**Section sources**
- [common.vue](file://web/src/components/upload/common.vue#L1-L90)

### 压缩上传（image）

专用于图像上传并自动压缩的组件。当图片体积超过设定阈值（默认 2MB）或分辨率过高时，自动调用浏览器 Canvas API 进行等比缩放和质量压缩。

#### Props 定义
- **imageUrl**: 字符串类型，可选，初始图片 URL。
- **fileSize**: 数字类型，可选，默认 2048 KB，超过此大小将触发压缩。
- **maxWH**: 数字类型，可选，默认 1920，限制最大宽高。
- **classId**: 分类 ID，同上。

#### 压缩流程
使用 `ImageCompress` 工具类读取文件为 Data URL，在 Canvas 中绘制并重新编码为 Blob，最终生成新的 File 对象供上传。压缩过程保持原始比例，避免失真。

**Section sources**
- [image.vue](file://web/src/components/upload/image.vue#L1-L102)
- [image.js](file://web/src/utils/image.js#L0-L91)

### 裁剪上传（cropper）

集成图像裁剪功能的上传组件，允许用户在上传前对图片进行可视化裁剪操作。具体实现依赖外部组件 `CropperImage`，未在当前上下文中展开。

**Section sources**
- [cropper.vue](file://web/src/components/upload/cropper.vue)

### 二维码上传（QR-code）

支持通过扫描二维码方式上传文件的特殊组件，通常用于移动端扫码上传场景。其内部逻辑由 `QRCodeUpload` 组件实现。

**Section sources**
- [QR-code.vue](file://web/src/components/upload/QR-code.vue)

## 图片选择器（selectImage）

一个功能完整的媒体库选择器，支持单选/多选模式、分类筛选、拖拽排序、重命名和删除操作。用户可从已有资源中选取图片或上传新文件。

### Props 定义
- **multiple**: 布尔类型，是否允许多选。
- **fileType**: 字符串，限定可选文件类型（如 `'image'`, `'video'`）。
- **maxUpdateCount**: 数字，多选模式下最大可选数量。
- **rounded**: 布尔类型，控制展示组件的圆角样式。

### 插槽与交互
组件内部使用 `selectComponent` 作为显示单元，点击后打开抽屉式媒体库。媒体库包含树形分类导航、搜索框、上传入口及分页列表。

### 核心功能流程
1. 打开抽屉时加载文件列表和分类数据；
2. 支持按关键词和分类过滤；
3. 可添加/编辑/删除分类；
4. 支持拖拽调整顺序（使用 `vuedraggable`）；
5. 选定后通过 `model` 双向绑定更新父组件数据。

**Section sources**
- [selectImage.vue](file://web/src/components/selectImage/selectImage.vue#L1-L503)
- [selectComponent.vue](file://web/src/components/selectImage/selectComponent.vue)
- [fileUploadAndDownload.js](file://web/src/api/fileUploadAndDownload.js#L9-L43)
- [attachmentCategory.js](file://web/src/api/attachmentCategory.js#L2-L25)

## 文件选择器（selectFile）

用于通用文件上传的选择器组件，支持多文件上传、限制数量、指定接受类型，并实时维护已上传文件列表。

### Props 定义
- **limit**: 最大上传数量，默认 3。
- **accept**: 接受的文件类型字符串（如 `.pdf,.docx`）。

### 数据绑定与事件
使用 `defineModel` 实现 `v-model` 双向绑定，`fileList` 同步显示上传状态。上传成功后将 `{ name, url }` 对象推入模型数组。

**Section sources**
- [selectFile.vue](file://web/src/components/selectFile/selectFile.vue#L1-L87)

## 数组控制器（arrayCtrl）

轻量级字符串数组管理组件，常用于标签输入场景。支持新增、删除和编辑数组元素。

### Props 定义
- **editable**: 布尔类型，是否允许编辑，默认 `false`。

### 实现机制
通过 `el-tag` 渲染现有标签，点击“+ 新增”按钮显示输入框。输入确认后将值推入 `modelValue` 数组。删除操作直接修改数组引用。

**Section sources**
- [arrayCtrl.vue](file://web/src/components/arrayCtrl/arrayCtrl.vue#L1-L67)

## OSS支持与断点续传机制

系统后端配置支持多种对象存储服务（OSS），包括本地存储、MinIO、阿里云、腾讯云、七牛、AWS S3 等。相关配置位于 `server/config` 目录下的各 `oss_*.go` 文件中。

### 多OSS适配机制
通过配置文件切换存储驱动，所有上传请求统一由 `/fileUploadAndDownload/upload` 接口处理，服务层根据当前配置调用相应 SDK 完成文件写入。

### 断点续传实现
断点续传功能由后端 `exa_breakpoint_continue.go` 提供支持，前端通过 `breakpoint.js` 调用相关接口。上传过程中记录分片信息，异常中断后可从中断位置继续上传，提升大文件传输稳定性。

**Section sources**
- [oss_local.go](file://server/config/oss_local.go)
- [oss_minio.go](file://server/config/oss_minio.go)
- [oss_aliyun.go](file://server/config/oss_aliyun.go)
- [oss_tencent.go](file://server/config/oss_tencent.go)
- [oss_qiniu.go](file://server/config/oss_qiniu.go)
- [oss_aws.go](file://server/config/oss_aws.go)
- [exa_breakpoint_continue.go](file://server/api/v1/example/exa_breakpoint_continue.go)
- [breakpoint.js](file://web/src/api/breakpoint.js)

## 实际调用示例与表单集成

以下为典型表单中集成上传组件的方式：

```vue
<template>
  <el-form :model="form">
    <!-- 单图上传 -->
    <el-form-item label="封面图">
      <select-image v-model="form.cover" />
    </el-form-item>

    <!-- 多图上传 -->
    <el-form-item label="图集">
      <select-image v-model="form.images" multiple :maxUpdateCount="1